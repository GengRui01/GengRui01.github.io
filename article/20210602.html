<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>企业微信群机器人发送消息 | 耿锐的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
    <meta name="description" content="耿锐的博客">
  
  
    <meta name="keywords" content="GengRui, 耿锐, 博客, 耿锐的博客">
  
  
    <link rel="alternate" href="/" title="耿锐的博客">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/localshare/css/share.css">

  
  
    
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  
<meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="耿锐的博客" type="application/atom+xml">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">耿锐的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">欢迎的来到耿锐的技术小栈</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> 首页</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> 归档</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> 关于</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-work-wechat-group-robot" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      企业微信群机器人发送消息
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-06-01T16:00:00.000Z" itemprop="datePublished">2021年06月02日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>

      
        <span class="article-views">
  <i class="fa fa-views"></i>
  <i id="busuanzi_container_page_pv">
      <i id="busuanzi_value_page_pv"></i>
  </i>
</span>

      
      
<a href="/article/20210602.html#comments" class="article-comment-link">
  
    
    
    
    
    
  
  <i class="fa fa-commt"></i>
  留言
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>这篇文章用来记录企业微信群机器人创建到发送消息的全过程，最后附有本文源码git地址，科学食用</p>
<a id="more"></a>

<h2 id="创建群机器人并获取Webhook地址"><a href="#创建群机器人并获取Webhook地址" class="headerlink" title="创建群机器人并获取Webhook地址"></a>创建群机器人并获取Webhook地址</h2><p>创建机器人的方式很简单，操作步骤及手机界面截图如下：</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/1.jpg" alt=""></p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/2.jpg" alt=""></p>
<ol>
<li>（图1）点击进入需要创建群机器人的群聊</li>
<li>（图2）点击右上角查看群聊信息的按钮</li>
<li>（图3）点击 <code>群机器人</code> 选项群机器人管理页面</li>
<li>（图4）点击 <code>添加机器人</code> 按钮添加新机器人</li>
<li>（图5）设置机器人头像、昵称，点击 <code>添加</code> 按钮</li>
<li>（图6）点击 <code>复制</code> 按钮复制Webhook地址， <strong>这个地址在之后发送请求中会用到，一定要记得复制下来哦</strong></li>
<li>（图6）点击 <code>配置说明</code> 查看官方配置文档</li>
<li>（图7）点击右上角三个点打开分享框，点击 <code>复制链接</code> 选项， <strong>这个地址是微信官方的群机器人配置文档，在开发过程中经常会用到，一定要记得复制下来哦</strong></li>
<li>（图8）返回群聊界面可以看到提示，说明群聊机器人已经添加成功</li>
</ol>
<p>步骤6和步骤8中我们复制了两个连接，如下：</p>
<p>Webhook地址： <code>https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=693a91f6-7xxx-4bc4-97a0-0ec2sifa5aaa</code></p>
<p>群机器人配置文档： <a href="https://work.weixin.qq.com/api/doc/90000/90136/91770" target="_blank" rel="noopener">https://work.weixin.qq.com/api/doc/90000/90136/91770</a></p>
<p><strong><em>关于Webhook地址:</em></strong></p>
<ul>
<li>Webhook地址的作用是开发者可以通过向这个地址发起POST请求来实现给该群组发送消息</li>
<li>每个机器人的webhook地址是不一样的，一定要保护好webhook地址避免泄漏，否则坏人就可以用你的机器人来发垃圾消息了</li>
</ul>
<p>如果刚才没有复制到Webhook地址，或者说再次开发时忘记Webhook地址，可以通过如下步骤查看群机器人的Webhook地址：</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/3.jpg" alt=""></p>
<ol>
<li>（图1）点击 <code>群机器人</code> 选项群机器人管理页面</li>
<li>（图2）选择需要查看Webhook地址的机器人</li>
<li>（图3）找到 <code>Webhook地址</code> 长按-&gt;全选-&gt;复制</li>
</ol>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><ol>
<li><p><a href="https://gengrui01.github.io/article/20210228.html" target="_blank" rel="noopener">使用IDEA创建Maven工程</a></p>
</li>
<li><p><a href="https://gengrui01.github.io/article/20210301.html" target="_blank" rel="noopener">IDEA配置Maven</a></p>
</li>
</ol>
<p>我们新建Maven项目名为“wechat-robot-demo“，设置好Maven版本、配置文件以及Maven仓库</p>
<h2 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h2><p>我们需要用到的依赖包及其所起作用如下：</p>
<ul>
<li>fastjson：处理JSON</li>
<li>httpclient：HTTP请求调用</li>
<li>junit：测试</li>
</ul>
<p>可以复制下面代码一次性导入：</p>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 处理JSON --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.76<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- HTTP请求调用 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 测试 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="基础代码"><a href="#基础代码" class="headerlink" title="基础代码"></a>基础代码</h2><h3 id="消息类型枚举类"><a href="#消息类型枚举类" class="headerlink" title="消息类型枚举类"></a>消息类型枚举类</h3><p>通过配置文档可以看出我们能够使用微信机器人去发送的消息类型主要有如下五种</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/4.png" alt=""></p>
<p>我们在common包下定义一个消息类型枚举类（MsgtypeEnum.java）枚举出所有的消息类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MsgtypeEnum &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文本类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    text(<span class="string">"text"</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * markdown类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    markdown(<span class="string">"markdown"</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    image(<span class="string">"image"</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图文类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    news(<span class="string">"news"</span>),</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    file(<span class="string">"file"</span>);</span><br><span class="line"></span><br><span class="line">    String value;</span><br><span class="line"></span><br><span class="line">    MsgtypeEnum(String value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息发送结果类"><a href="#消息发送结果类" class="headerlink" title="消息发送结果类"></a>消息发送结果类</h3><p>在请求webhook时会返回请求结果，里面有错误编码、错误信息等信息</p>
<p>我们在common包下定义一个消息发送结果类（SendResult.java）来存储我们需要的请求结果信息</p>
<p>重写toString()方法为JSON格式，方便我们在测试时打印请求结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendResult</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否请求成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isSuccess;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求错误编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String errorCode;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求错误信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String errorMsg;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; items = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        items.put(<span class="string">"errorCode"</span>, errorCode);</span><br><span class="line">        items.put(<span class="string">"errorMsg"</span>, errorMsg);</span><br><span class="line">        items.put(<span class="string">"isSuccess"</span>, isSuccess);</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(items);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SendResult</span><span class="params">(<span class="keyword">boolean</span> isSuccess, String errorCode, String errorMsg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.isSuccess = isSuccess;</span><br><span class="line">        <span class="keyword">this</span>.errorCode = errorCode;</span><br><span class="line">        <span class="keyword">this</span>.errorMsg = errorMsg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 省略getter&amp;setter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息通用接口"><a href="#消息通用接口" class="headerlink" title="消息通用接口"></a>消息通用接口</h3><p>不同消息类型请求时数据格式是不同的，但相同点是它们都需要以JSON的格式发送Webhook请求</p>
<p>我们在message包下定义一个消息通用接口（Message.java）</p>
<p>并在消息通用接口里定义toJson()方法，保证所有实现消息通用接口的类都提供toJson()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">toJson</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="发送请求类"><a href="#发送请求类" class="headerlink" title="发送请求类"></a>发送请求类</h3><p>在创建群机器人时说过我们是要通过调用群组机器人的Webhook地址发起POST请求来实现给该群组发送消息</p>
<p>我们在api包下定义一个消息发送结果类（WechatRobotApi.java）来完成Webhook地址的POST请求调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WechatRobotApi</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sendUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SendResult <span class="title">send</span><span class="params">(String sendUrl, Message message)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 判断sendUrl是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(sendUrl)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SendResult(<span class="keyword">false</span>, <span class="string">"10000"</span>, <span class="string">"webhook地址不可为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 发送post请求</span></span><br><span class="line">            HttpResponse response = post(sendUrl, message.toJson());</span><br><span class="line">            <span class="keyword">if</span> (response.getStatusLine().getStatusCode() != HttpStatus.SC_OK) &#123;</span><br><span class="line">                String errorCode = <span class="string">"10"</span> + response.getStatusLine().getStatusCode();</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> SendResult(<span class="keyword">false</span>, errorCode, <span class="string">"Http请求错误 错误编码为后三位"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                String result = <span class="keyword">null</span>;</span><br><span class="line">                result = EntityUtils.toString(response.getEntity());</span><br><span class="line"></span><br><span class="line">                JSONObject obj = JSONObject.parseObject(result);</span><br><span class="line">                String errorCode = obj.getString(<span class="string">"errcode"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> SendResult(errorCode.equals(<span class="number">0</span>), errorCode, obj.getString(<span class="string">"errmsg"</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SendResult(<span class="keyword">false</span>, <span class="string">"10001"</span>, e.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SendResult(<span class="keyword">false</span>, <span class="string">"10002"</span>, <span class="string">"Http请求IO异常"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送post请求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sendUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> json</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> HttpResponse <span class="title">post</span><span class="params">(String sendUrl, String json)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        HttpPost httppost = <span class="keyword">new</span> HttpPost(sendUrl);</span><br><span class="line">        httppost.addHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json; charset=utf-8"</span>);</span><br><span class="line">        StringEntity se = <span class="keyword">new</span> StringEntity(json, <span class="string">"utf-8"</span>);</span><br><span class="line">        httppost.setEntity(se);</span><br><span class="line">        HttpResponse response = HttpClients.createDefault().execute(httppost);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="测试Webhook配置类"><a href="#测试Webhook配置类" class="headerlink" title="测试Webhook配置类"></a>测试Webhook配置类</h3><p>因为每个机器人的webhook地址是不一样的</p>
<p>我们在config包下定义测试Webhook配置类（WebhookConfig.java）来配置用于测试的群机器人webhook地址</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebhookConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String url = <span class="string">"https://qyapi.weixin.qq.com/cgi-bin/webhook/"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String send = <span class="string">"send?key="</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String upload_media = <span class="string">"upload_media?key="</span>;</span><br><span class="line">    <span class="comment">//TODO 改成自己用于测试的群机器人webhook地址中key的值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String key = <span class="string">"693a91f6-7xxx-4bc4-97a0-0ec2sifa5aaa"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 消息发送URL</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String send_url = url + send + key;</span><br><span class="line">    <span class="comment">// 文件上传URL（文件类型消息上传文件时需要用到的URL）</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String upload_media_url = url + upload_media + key;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>以上已经完成了基础代码，接下来争对不同消息类型进行定制开发即可</p>
<p>观察不同消息类型的参数数据格式可以发现第二个参数名根据消息类型均不相同，所以最外部两个参数直接用JSON封装就好</p>
<p>但相同信息类型第二个参数内部的数据格式是相同的，我们可以根据第二个参数内部的数据格式进行开发</p>
<h2 id="文本类型"><a href="#文本类型" class="headerlink" title="文本类型"></a>文本类型</h2><p>文本类型数据格式如下图所示：</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/5.png" alt=""></p>
<h3 id="文本类型消息类"><a href="#文本类型消息类" class="headerlink" title="文本类型消息类"></a>文本类型消息类</h3><p>我们在message包下定义一个文本类型消息类（TextMessage.java）</p>
<p>实现消息通用接口（Message.java）并完善toJson()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextMessage</span> <span class="keyword">implements</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文本内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否@所有人</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> isAtAll;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 需要@的群成员手机号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; mentionedMobileList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toJson</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        result.put(<span class="string">"msgtype"</span>, MsgtypeEnum.text.getValue());</span><br><span class="line">    </span><br><span class="line">        Map&lt;String, Object&gt; textContent = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(text)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"文本内容不可为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        textContent.put(<span class="string">"content"</span>, text);</span><br><span class="line">        <span class="keyword">if</span> (isAtAll) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mentionedMobileList == <span class="keyword">null</span>)</span><br><span class="line">                mentionedMobileList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">            mentionedMobileList.add(<span class="string">"@all"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mentionedMobileList != <span class="keyword">null</span> &amp;&amp; !mentionedMobileList.isEmpty()) &#123;</span><br><span class="line">            textContent.put(<span class="string">"mentioned_mobile_list"</span>, mentionedMobileList);</span><br><span class="line">        &#125;</span><br><span class="line">        result.put(<span class="string">"text"</span>, textContent);</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TextMessage</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.text = text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略getter&amp;setter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文本类型消息测试类"><a href="#文本类型消息测试类" class="headerlink" title="文本类型消息测试类"></a>文本类型消息测试类</h3><p>我们在test包下定义文本类型消息测试类（TextMessageTest.java）来测试文本类型消息发送</p>
<ol>
<li>普通文本消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通文本消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNormal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TextMessage message = <span class="keyword">new</span> TextMessage(<span class="string">"Hello World!"</span>);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/6.jpg" alt=""></p>
<ol start="2">
<li>@群内成员的文本消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 艾特群内成员的文本消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWithAt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TextMessage message = <span class="keyword">new</span> TextMessage(<span class="string">"你好，我是耿锐的助手"</span>);</span><br><span class="line">        List&lt;String&gt; mentionedMobileList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        mentionedMobileList.add(<span class="string">"13026212376"</span>);</span><br><span class="line">        message.setMentionedMobileList(mentionedMobileList);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/7.jpg" alt=""></p>
<p><strong><em>插播一个吐槽：</em></strong></p>
<blockquote>
<p>什么鬼人啊啊啊啊啊，艾特了一下就把我机器人移除了2333333<br>师父让我打他，这人高马大的，我一女孩子哪打得过啊，默默重新添加了一个机器人<br>要注意重新添加机器人后webhook地址会变，需要修改测试Webhook配置类（WebhookConfig.java）中webhook地址</p>
</blockquote>
<ol start="3">
<li>@所有人的文本消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 艾特所有人的文本消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWithAtAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TextMessage message = <span class="keyword">new</span> TextMessage(<span class="string">"大家好，我是耿锐的助手"</span>);</span><br><span class="line">        message.setIsAtAll(<span class="keyword">true</span>);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/8.jpg" alt=""></p>
<ol start="4">
<li>@群内成员并且@所有人的文本消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TextMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 艾特群内成员并且艾特所有人的文本消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWithAtAndAtAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        TextMessage message = <span class="keyword">new</span> TextMessage(<span class="string">"大家好，通报批评就是他刚才移除了我"</span>);</span><br><span class="line">        List&lt;String&gt; mentionedMobileList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        mentionedMobileList.add(<span class="string">"13026212376"</span>);</span><br><span class="line">        message.setMentionedMobileList(mentionedMobileList);</span><br><span class="line">        message.setIsAtAll(<span class="keyword">true</span>);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/9.jpg" alt=""></p>
<h2 id="markdown类型"><a href="#markdown类型" class="headerlink" title="markdown类型"></a>markdown类型</h2><p>markdown类型数据格式如下图所示：</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/10.png" alt=""></p>
<h3 id="markdown类型消息类"><a href="#markdown类型消息类" class="headerlink" title="markdown类型消息类"></a>markdown类型消息类</h3><p>我们在message包下定义一个markdown类型消息类（MarkdownMessage.java）</p>
<p>实现消息通用接口（Message.java）并完善toJson()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkdownMessage</span> <span class="keyword">implements</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * markdown元素列表 每一行内容为一个元素</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; items = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        items.add(text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toJson</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        result.put(<span class="string">"msgtype"</span>, MsgtypeEnum.markdown.getValue());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (items.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"markdown内容不可为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer markdownText = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (String item : items) &#123;</span><br><span class="line">            markdownText.append(item + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; markdown = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        markdown.put(<span class="string">"content"</span>, markdownText.toString());</span><br><span class="line">        result.put(<span class="string">"markdown"</span>, markdown);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="markdown字体颜色枚举类"><a href="#markdown字体颜色枚举类" class="headerlink" title="markdown字体颜色枚举类"></a>markdown字体颜色枚举类</h3><p>我们在utils包下定义markdown字体颜色枚举类（MarkdownColorEnum.java）枚举出markdown所支持的所有字体颜色</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> MarkdownColorEnum &#123;</span><br><span class="line">    orange(<span class="string">"warning"</span>),</span><br><span class="line">    gray(<span class="string">"comment"</span>),</span><br><span class="line">    green(<span class="string">"info"</span>);</span><br><span class="line"></span><br><span class="line">    String value;</span><br><span class="line"></span><br><span class="line">    MarkdownColorEnum(String value) &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="markdown工具类"><a href="#markdown工具类" class="headerlink" title="markdown工具类"></a>markdown工具类</h3><p>我们在utils包下定义markdown工具类（MarkdownUtils.java）提供方法将内容转化为不同格式的markdown语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkdownUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标题</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headerType 标题等级</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text       标题内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getHeaderText</span><span class="params">(<span class="keyword">int</span> headerType, String text)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (headerType &lt; <span class="number">1</span> || headerType &gt; <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"标题等级必须在1-6之间"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer numbers = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; headerType; i++) &#123;</span><br><span class="line">            numbers.append(<span class="string">"#"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> numbers + <span class="string">" "</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加粗</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getBoldText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"**"</span> + text + <span class="string">"**"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 链接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text 连接标题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> href 具体链接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getLinkText</span><span class="params">(String text, String href)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"["</span> + text + <span class="string">"]("</span> + href + <span class="string">")"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 行内代码段（暂不支持跨行）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCodeText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"`"</span> + text + <span class="string">"`"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 引用</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getQuoteText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&gt;"</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字体颜色（只支持3种内置颜色）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> markdownColorEnum</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getColorText</span><span class="params">(MarkdownColorEnum markdownColorEnum, String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"&lt;font color=\""</span> + markdownColorEnum.value + <span class="string">"\"&gt;"</span> + text + <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 斜体</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getItalicText</span><span class="params">(String text)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"*"</span> + text + <span class="string">"*"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 有序列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> orderList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getOrderListText</span><span class="params">(List&lt;String&gt; orderList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (orderList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= orderList.size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            sb.append(String.valueOf(i) + <span class="string">". "</span> + orderList.get(i - <span class="number">1</span>) + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(String.valueOf(orderList.size()) + <span class="string">". "</span> + orderList.get(orderList.size() - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 无序列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unOrderList</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getUnOrderListText</span><span class="params">(List&lt;String&gt; unOrderList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (unOrderList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; unOrderList.size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">            sb.append(<span class="string">"- "</span> + unOrderList.get(i) + <span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        sb.append(<span class="string">"- "</span> + unOrderList.get(unOrderList.size() - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="markdown类型消息测试类"><a href="#markdown类型消息测试类" class="headerlink" title="markdown类型消息测试类"></a>markdown类型消息测试类</h3><p>我们在test包下定义markdown类型消息测试类（MarkdownMessageTest.java）来测试markdown类型消息发送</p>
<ol>
<li>普通markdown消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkdownMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通markdown消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNormal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MarkdownMessage message = <span class="keyword">new</span> MarkdownMessage();</span><br><span class="line">        message.add(<span class="string">"正常内容"</span>);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/11.jpg" alt=""></p>
<ol start="2">
<li>带有标题的markdown消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkdownMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带有标题的markdown消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MarkdownMessage message = <span class="keyword">new</span> MarkdownMessage();</span><br><span class="line"></span><br><span class="line">        message.add(<span class="string">"普通MD消息"</span>);</span><br><span class="line">        message.add(MarkdownUtils.getHeaderText(<span class="number">1</span>, <span class="string">"一级标题"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getHeaderText(<span class="number">2</span>, <span class="string">"二级标题"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getHeaderText(<span class="number">3</span>, <span class="string">"三级标题"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getHeaderText(<span class="number">4</span>, <span class="string">"四级标题"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getHeaderText(<span class="number">5</span>, <span class="string">"五级标题"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getHeaderText(<span class="number">6</span>, <span class="string">"六级标题"</span>));</span><br><span class="line"></span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/12.jpg" alt=""></p>
<ol start="2">
<li>带有字体颜色（只支持3种内置颜色）的markdown消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkdownMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带有字体颜色（只支持3种内置颜色）的markdown消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testColour</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MarkdownMessage message = <span class="keyword">new</span> MarkdownMessage();</span><br><span class="line"></span><br><span class="line">        message.add(MarkdownUtils.getColorText(MarkdownColorEnum.orange, <span class="string">"橙色内容"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getColorText(MarkdownColorEnum.gray, <span class="string">"灰色内容"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getColorText(MarkdownColorEnum.green, <span class="string">"绿色内容"</span>));</span><br><span class="line"></span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/13.jpg" alt=""></p>
<ol start="3">
<li>带有有序、无序列表的markdown消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkdownMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带有有序、无序列表的markdown消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MarkdownMessage message = <span class="keyword">new</span> MarkdownMessage();</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; orderList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        orderList.add(<span class="string">"有序列表1"</span>);</span><br><span class="line">        orderList.add(<span class="string">"有序列表2"</span>);</span><br><span class="line">        message.add(MarkdownUtils.getOrderListText(orderList));</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;String&gt; unOrderList = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        unOrderList.add(<span class="string">"无序列表1"</span>);</span><br><span class="line">        unOrderList.add(<span class="string">"无序列表2"</span>);</span><br><span class="line">        message.add(MarkdownUtils.getUnOrderListText(unOrderList));</span><br><span class="line"></span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/14.jpg" alt=""></p>
<ol start="4">
<li>带有其他格式的markdown消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkdownMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 带有其他格式的markdown消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOthers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MarkdownMessage message = <span class="keyword">new</span> MarkdownMessage();</span><br><span class="line"></span><br><span class="line">        message.add(MarkdownUtils.getBoldText(<span class="string">"加粗内容"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getLinkText(<span class="string">"链接内容"</span>, <span class="string">"https://www.gengruiblog.cn/"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getCodeText(<span class="string">"代码内容"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getQuoteText(<span class="string">"引用内容"</span>));</span><br><span class="line">        message.add(MarkdownUtils.getItalicText(<span class="string">"斜体内容"</span>));</span><br><span class="line"></span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/15.jpg" alt=""></p>
<h2 id="图片类型"><a href="#图片类型" class="headerlink" title="图片类型"></a>图片类型</h2><p>图片类型数据格式如下图所示：</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/16.png" alt=""></p>
<h3 id="图片类型消息类"><a href="#图片类型消息类" class="headerlink" title="图片类型消息类"></a>图片类型消息类</h3><p>我们在message包下定义一个图片类型消息类（ImageMessage.java）</p>
<p>实现消息通用接口（Message.java）并完善toJson()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageMessage</span> <span class="keyword">implements</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片内容的base64编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String base64;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图片内容（base64编码前）的md5值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String md5;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ImageMessage</span><span class="params">(String base64, String md5)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.base64 = base64;</span><br><span class="line">        <span class="keyword">this</span>.md5 = md5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toJson</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; items = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        items.put(<span class="string">"msgtype"</span>, MsgtypeEnum.image.getValue());</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; textContent = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(base64)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"base64编码不可为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        textContent.put(<span class="string">"base64"</span>, base64);</span><br><span class="line">        textContent.put(<span class="string">"md5"</span>, md5);</span><br><span class="line">        items.put(<span class="string">"image"</span>, textContent);</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(items);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="图片工具类"><a href="#图片工具类" class="headerlink" title="图片工具类"></a>图片工具类</h3><p>我们在utils包下定义图片工具类（ImageUtils.java）提供方法将本地图片和线上图片转化为图片类型消息类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 本地图片转换</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imgFile 图片本地路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> yanceyzhang</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImageMessage <span class="title">toMessageByLocal</span><span class="params">(String imgFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] data = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream in = <span class="keyword">new</span> FileInputStream(imgFile);</span><br><span class="line">            data = <span class="keyword">new</span> <span class="keyword">byte</span>[in.available()];</span><br><span class="line">            in.read(data);</span><br><span class="line">            in.close();</span><br><span class="line">            String base64 = Base64.getEncoder().encodeToString(data);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ImageMessage(base64, DigestUtils.md5Hex(data));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"本地图片读取IO异常"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 线上图片转换</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imgURL 图片线上路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> yanceyzhang</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImageMessage <span class="title">toMessageByOnline</span><span class="params">(String imgURL)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ByteArrayOutputStream data = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">            <span class="comment">// 创建URL</span></span><br><span class="line">            URL url = <span class="keyword">new</span> URL(imgURL);</span><br><span class="line">            <span class="keyword">byte</span>[] by = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="comment">// 创建链接</span></span><br><span class="line">            HttpURLConnection conn = (HttpURLConnection) url.openConnection();</span><br><span class="line">            conn.setRequestMethod(<span class="string">"GET"</span>);</span><br><span class="line">            conn.setConnectTimeout(<span class="number">20000</span>);</span><br><span class="line">            conn.setReadTimeout(<span class="number">20000</span>);</span><br><span class="line">            InputStream is = conn.getInputStream();</span><br><span class="line">            <span class="comment">// 将内容读取内存中</span></span><br><span class="line">            <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> ((len = is.read(by)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                data.write(by, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">byte</span>[] b = data.toByteArray();</span><br><span class="line">            String base64 = Base64.getEncoder().encodeToString(b);</span><br><span class="line">            String md5 = DigestUtils.md5Hex(b);</span><br><span class="line">            is.close();</span><br><span class="line">            conn.disconnect();</span><br><span class="line">            data.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ImageMessage(base64, md5);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"线上图片读取IO异常"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="图片类型消息测试类"><a href="#图片类型消息测试类" class="headerlink" title="图片类型消息测试类"></a>图片类型消息测试类</h3><p>我们在test包下定义图片类型消息测试类（ImageMessageTest.java）来测试图片类型消息发送</p>
<ol>
<li>本地图片消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 本地图片消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLocal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String urlLocal = <span class="string">"D:/Blog/avatar.png"</span>;</span><br><span class="line">        ImageMessage message = ImageUtils.toMessageByLocal(urlLocal);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/17.jpg" alt=""></p>
<ol start="2">
<li>线上图片消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 线上图片消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOnline</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String urlOnLine = <span class="string">"https://www.gengruiblog.cn/favicon.png"</span>;</span><br><span class="line">        ImageMessage message = ImageUtils.toMessageByOnline(urlOnLine);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/18.jpg" alt=""></p>
<h2 id="图文类型"><a href="#图文类型" class="headerlink" title="图文类型"></a>图文类型</h2><p>图文类型数据格式如下图所示：</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/19.png" alt=""></p>
<h3 id="文章类"><a href="#文章类" class="headerlink" title="文章类"></a>文章类</h3><p>由于一个图文消息支持1-8篇文章</p>
<p>我们先在message包下定义一个文章类（Article.java）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Article</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 标题</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 描述</span></span><br><span class="line"><span class="comment">     * 可省略</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 点击后跳转的链接</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 图文消息的图片链接，支持JPG、PNG格式，较好的效果为大图 1068*455，小图150*150</span></span><br><span class="line"><span class="comment">     * 可省略</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String picurl;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Article</span><span class="params">(String title, String description, String url, String picurl)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.title = title;</span><br><span class="line">        <span class="keyword">this</span>.description = description;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">        <span class="keyword">this</span>.picurl = picurl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略getter&amp;setter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="图文类型消息类"><a href="#图文类型消息类" class="headerlink" title="图文类型消息类"></a>图文类型消息类</h3><p>之后在message包下定义一个图文类型消息类（NewsMessage.java）里面存放文章类的List</p>
<p>并且实现消息通用接口（Message.java）并完善toJson()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsMessage</span> <span class="keyword">implements</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文章列表 一个图文消息支持1-8篇文章</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Article&gt; articles = <span class="keyword">new</span> ArrayList&lt;Article&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addArticle</span><span class="params">(Article article)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (articles.size() &gt; <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"每条图文消息所包含的文章数不可超过八个"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        articles.add(article);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toJson</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; items = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        items.put(<span class="string">"msgtype"</span>, MsgtypeEnum.news.getValue());</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; news = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        <span class="keyword">if</span> (articles.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"图文消息中不可以没有文章"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        news.put(<span class="string">"articles"</span>, articles);</span><br><span class="line">        items.put(<span class="string">"news"</span>, news);</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(items);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="图文类型消息测试类"><a href="#图文类型消息测试类" class="headerlink" title="图文类型消息测试类"></a>图文类型消息测试类</h3><p>我们在test包下定义图片类型消息测试类（NewsMessageTest.java）来测试图片类型消息发送</p>
<ol>
<li>一条图文消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一条图文消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneArticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        NewsMessage message = <span class="keyword">new</span> NewsMessage();</span><br><span class="line">        message.addArticle(<span class="keyword">new</span> Article(<span class="string">"耿锐的博客"</span>, <span class="string">"欢迎的来到耿锐的技术小栈"</span>,</span><br><span class="line">                <span class="string">"https://www.gengruiblog.cn/"</span>, <span class="string">"https://www.gengruiblog.cn/favicon.png"</span>));</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/20.jpg" alt=""></p>
<ol start="2">
<li>多条图文消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 多条图文消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMoreArticle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        NewsMessage message = <span class="keyword">new</span> NewsMessage();</span><br><span class="line">        message.addArticle(<span class="keyword">new</span> Article(<span class="string">"有描述有长方形图"</span>, <span class="string">"耿锐的博客 - MVC设计模式"</span>,</span><br><span class="line">                <span class="string">"https://www.gengruiblog.cn/article/20210224.html"</span>, <span class="string">"https://www.gengruiblog.cn/picture/mvc/2.png"</span>));</span><br><span class="line">        message.addArticle(<span class="keyword">new</span> Article(<span class="string">"有描述有方形图"</span>, <span class="string">"昆大圣博客 - 迷失的人迷失了，相逢的人会再相逢"</span>,</span><br><span class="line">                <span class="string">"https://blog.ecutdl.cn/"</span>, <span class="string">"https://blog.ecutdl.cn/usr/uploads/2021/05/3275615662.png"</span>));</span><br><span class="line">        message.addArticle(<span class="keyword">new</span> Article(<span class="string">"有描述无图"</span>, <span class="string">"昆大圣博客 - 留言板"</span>,</span><br><span class="line">                <span class="string">"https://blog.ecutdl.cn/3.html"</span>, <span class="keyword">null</span>));</span><br><span class="line">        message.addArticle(<span class="keyword">new</span> Article(<span class="string">"无描述有长方形图"</span>, <span class="keyword">null</span>,</span><br><span class="line">                <span class="string">"https://www.baidu.com/"</span>, <span class="string">"https://dss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/img/logo/logo_white-d0c9fe2af5.png"</span>));</span><br><span class="line">        message.addArticle(<span class="keyword">new</span> Article(<span class="string">"无描述有方形图"</span>, <span class="keyword">null</span>,</span><br><span class="line">                <span class="string">"https://www.gengruiblog.cn/"</span>, <span class="string">"https://www.gengruiblog.cn/favicon.png"</span>));</span><br><span class="line">        message.addArticle(<span class="keyword">new</span> Article(<span class="string">"无描述无图"</span>, <span class="keyword">null</span>,</span><br><span class="line">                <span class="string">"https://www.baidu.com/"</span>, <span class="keyword">null</span>));</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/21.jpg" alt=""></p>
<h2 id="文件类型"><a href="#文件类型" class="headerlink" title="文件类型"></a>文件类型</h2><p>文件类型数据格式如下图所示：</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/22.png" alt=""></p>
<p>在发送文件类型消息时需要用到下图所示文件上传接口拿到media_id（三天内有效）</p>
<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/23.png" alt=""></p>
<h3 id="文件工具类"><a href="#文件工具类" class="headerlink" title="文件工具类"></a>文件工具类</h3><p>我们在utils包下定义文件工具类（FileUtils.java）提供方法完成文件上传拿到media_id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件上传得到media_id，该media_id仅三天内有效</span></span><br><span class="line"><span class="comment">     * media_id在同一企业内应用之间可以共享</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uploadMediaUrl</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">upload</span><span class="params">(String uploadMediaUrl, String filePath)</span> </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists() || !file.isFile()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"文件不存在"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 返回结果</span></span><br><span class="line">        String result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 设置边界</span></span><br><span class="line">            String boundary = <span class="string">"----------"</span> + System.currentTimeMillis();</span><br><span class="line">            <span class="comment">// 获取连接并设置请求头</span></span><br><span class="line">            HttpsURLConnection conn = getConnection(uploadMediaUrl, boundary);</span><br><span class="line">            <span class="comment">// 设置请求正文信息</span></span><br><span class="line">            setFileContent(conn.getOutputStream(), file, boundary);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (HttpsURLConnection.HTTP_OK != conn.getResponseCode()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Http请求错误 错误编码为"</span> + conn.getResponseCode());</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 获取请求结果</span></span><br><span class="line">                result = getResult(conn.getInputStream());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"HTTP请求IO异常"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        JSONObject jsonObject = JSONObject.parseObject(result);</span><br><span class="line">        <span class="keyword">if</span> (!jsonObject.getInteger(<span class="string">"errcode"</span>).equals(<span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(jsonObject.getString(<span class="string">"errmsg"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> jsonObject.getString(<span class="string">"media_id"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接并设置请求头</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * POST https://qyapi.weixin.qq.com/cgi-bin/webhook/upload_media?key=693a91f6-7xxx-4bc4-97a0-0ec2sifa5aaa&amp;type=file HTTP/1.1</span></span><br><span class="line"><span class="comment">     * Content-Type: multipart/form-data; boundary=-------------------------acebdf13572468</span></span><br><span class="line"><span class="comment">     * Content-Length: 220</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uploadMediaUrl 地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> boundary       边界值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> HttpsURLConnection <span class="title">getConnection</span><span class="params">(String uploadMediaUrl, String boundary)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        URL url = <span class="keyword">new</span> URL(uploadMediaUrl);</span><br><span class="line">        HttpsURLConnection conn = (HttpsURLConnection) url.openConnection();</span><br><span class="line">        conn.setRequestMethod(<span class="string">"POST"</span>);<span class="comment">// 以POST方式提交表单</span></span><br><span class="line">        conn.setUseCaches(<span class="keyword">false</span>);<span class="comment">// POST方式不能使用缓存</span></span><br><span class="line">        conn.setDoInput(<span class="keyword">true</span>);</span><br><span class="line">        conn.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 设置请求头信息</span></span><br><span class="line">        conn.setRequestProperty(<span class="string">"Connection"</span>, <span class="string">"Keep-Alive"</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">"Charset"</span>, <span class="string">"UTF-8"</span>);</span><br><span class="line">        conn.setRequestProperty(<span class="string">"Content-Type"</span>, <span class="string">"multipart/form-data; boundary="</span> + boundary);</span><br><span class="line">        conn.setRequestProperty(<span class="string">"Content-Length"</span>, <span class="string">"220"</span>);</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置请求正文信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * ---------------------------acebdf13572468</span></span><br><span class="line"><span class="comment">     * Content-Disposition: form-data; name="media";filename="wework.txt"; filelength=6</span></span><br><span class="line"><span class="comment">     * Content-Type: application/octet-stream</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * mytext</span></span><br><span class="line"><span class="comment">     * ---------------------------acebdf13572468--</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> boundary</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setFileContent</span><span class="params">(OutputStream outputStream, File file, String boundary)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 头部内容</span></span><br><span class="line">        StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        sb.append(<span class="string">"--"</span>);<span class="comment">// 必须多两条道</span></span><br><span class="line">        sb.append(boundary);</span><br><span class="line">        sb.append(<span class="string">"\r\n"</span>);</span><br><span class="line">        sb.append(<span class="string">"Content-Disposition: form-data;name=\"media\"; filename=\""</span> + file.getName() + <span class="string">"\"\r\n"</span>);</span><br><span class="line">        sb.append(<span class="string">"Content-Type:application/octet-stream\r\n\r\n"</span>);</span><br><span class="line">        outputStream.write(sb.toString().getBytes(<span class="string">"UTF-8"</span>));</span><br><span class="line">        <span class="comment">// 正文部分 把文件以流的方式读取后推送道URL中</span></span><br><span class="line">        DataInputStream din = <span class="keyword">new</span> DataInputStream(<span class="keyword">new</span> FileInputStream(file));</span><br><span class="line">        <span class="keyword">int</span> bytes = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] buffer = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">while</span> ((bytes = din.read(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">            outputStream.write(buffer, <span class="number">0</span>, bytes);</span><br><span class="line">        &#125;</span><br><span class="line">        din.close();</span><br><span class="line">        <span class="comment">// 尾部内容</span></span><br><span class="line">        <span class="keyword">byte</span>[] foot = (<span class="string">"\r\n--"</span> + boundary + <span class="string">"--\r\n"</span>).getBytes(<span class="string">"UTF-8"</span>);<span class="comment">// 定义数据最后分割线</span></span><br><span class="line">        outputStream.write(foot);</span><br><span class="line">        outputStream.flush();</span><br><span class="line">        outputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取请求结果</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inputStream</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getResult</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        StringBuffer strbuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">        String lineString;</span><br><span class="line">        <span class="keyword">while</span> ((lineString = reader.readLine()) != <span class="keyword">null</span>)</span><br><span class="line">            strbuffer.append(lineString);</span><br><span class="line">        reader.close();</span><br><span class="line">        <span class="keyword">return</span> strbuffer.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件类型消息类"><a href="#文件类型消息类" class="headerlink" title="文件类型消息类"></a>文件类型消息类</h3><p>我们在message包下定义一个图片类型消息类（FileMessage.java）</p>
<p>实现消息通用接口（Message.java）并完善toJson()方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileMessage</span> <span class="keyword">implements</span> <span class="title">Message</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过文件上传接口获取的文件id 三天内有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String media_id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FileMessage</span><span class="params">(String media_id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.media_id = media_id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 消息的Json格式字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toJson</span><span class="params">()</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line">        Map&lt;String, Object&gt; items = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        items.put(<span class="string">"msgtype"</span>, MsgtypeEnum.file.getValue());</span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; textContent = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(media_id)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"通过文件上传接口获取的文件id不可为空"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        textContent.put(<span class="string">"media_id"</span>, media_id);</span><br><span class="line">        items.put(<span class="string">"file"</span>, textContent);</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(items);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="文件类型消息测试类"><a href="#文件类型消息测试类" class="headerlink" title="文件类型消息测试类"></a>文件类型消息测试类</h3><p>我们在test包下定义文件类型消息测试类（FileMessageTest.java）来测试文件类型消息发送</p>
<ol>
<li>普通文件消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileMessageTest</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 普通文件消息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNormal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String mediaId = FileUtils.upload(WebhookConfig.upload_media_url, <span class="string">"D:/Work/需求调研汇总.xlsx"</span>);</span><br><span class="line">        FileMessage message = <span class="keyword">new</span> FileMessage(mediaId);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/24.jpg" alt=""></p>
<ol start="2">
<li>音频文件消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 音频文件消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMusic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String mediaId = FileUtils.upload(WebhookConfig.upload_media_url, <span class="string">"D:/KuGou/汪苏泷 - 有点甜.mp3"</span>);</span><br><span class="line">        FileMessage message = <span class="keyword">new</span> FileMessage(mediaId);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/25.jpg" alt=""></p>
<ol start="3">
<li>视频文件消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileMessageTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频文件消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVideo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String mediaId = FileUtils.upload(WebhookConfig.upload_media_url, <span class="string">"D:/Video/明月千古情.mp4"</span>);</span><br><span class="line">        FileMessage message = <span class="keyword">new</span> FileMessage(mediaId);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/26.jpg" alt=""></p>
<ol start="4">
<li>图片文件消息</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileMessageTest</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 图片文件消息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPicture</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String mediaId = FileUtils.upload(WebhookConfig.upload_media_url, <span class="string">"D:/Blog/avatar.png"</span>);</span><br><span class="line">        FileMessage message = <span class="keyword">new</span> FileMessage(mediaId);</span><br><span class="line">        SendResult result = WechatRobotApi.send(WebhookConfig.send_url, message);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://gengrui01.github.io/picture/work-wechat-group-robot/27.jpg" alt=""></p>
<h2 id="本文源码"><a href="#本文源码" class="headerlink" title="本文源码"></a>本文源码</h2><p>如上已经完成了企业微信群机器人所提供的所有类型消息发送</p>
<p><a href="https://github.com/GengRui01/wechat-robot-demo" target="_blank" rel="noopener">GengRui01/wechat-robot-demo</a></p>

        
            <div id="toc-article">
                
  <div class="widget-wrap" id="toc-wrap">
    <h3 class="widget-title"><i class="fa fa-toc"></i> 文章目录</h3>
    <div class="widget">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建群机器人并获取Webhook地址"><span class="toc-text">创建群机器人并获取Webhook地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建项目"><span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#引入依赖"><span class="toc-text">引入依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基础代码"><span class="toc-text">基础代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#消息类型枚举类"><span class="toc-text">消息类型枚举类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#消息发送结果类"><span class="toc-text">消息发送结果类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#消息通用接口"><span class="toc-text">消息通用接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#发送请求类"><span class="toc-text">发送请求类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#测试Webhook配置类"><span class="toc-text">测试Webhook配置类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文本类型"><span class="toc-text">文本类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文本类型消息类"><span class="toc-text">文本类型消息类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文本类型消息测试类"><span class="toc-text">文本类型消息测试类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#markdown类型"><span class="toc-text">markdown类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#markdown类型消息类"><span class="toc-text">markdown类型消息类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#markdown字体颜色枚举类"><span class="toc-text">markdown字体颜色枚举类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#markdown工具类"><span class="toc-text">markdown工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#markdown类型消息测试类"><span class="toc-text">markdown类型消息测试类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图片类型"><span class="toc-text">图片类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#图片类型消息类"><span class="toc-text">图片类型消息类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片工具类"><span class="toc-text">图片工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图片类型消息测试类"><span class="toc-text">图片类型消息测试类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图文类型"><span class="toc-text">图文类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文章类"><span class="toc-text">文章类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图文类型消息类"><span class="toc-text">图文类型消息类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#图文类型消息测试类"><span class="toc-text">图文类型消息测试类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件类型"><span class="toc-text">文件类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#文件工具类"><span class="toc-text">文件工具类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件类型消息类"><span class="toc-text">文件类型消息类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件类型消息测试类"><span class="toc-text">文件类型消息测试类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#本文源码"><span class="toc-text">本文源码</span></a></li></ol>
    </div>
  </div>


            </div>
        
        
          <blockquote id="copyright">
              <p>原文链接: <a href="https://www.gengruiblog.cn/article/20210602.html">https://www.gengruiblog.cn/article/20210602.html</a></p>
              <p>版权声明: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          
    <div class="article-reward">
        <a id="reward-btn" href="javascript:;">打赏</a>
        <div id="reward-content">
            <h6 class="reward-tit">“感谢你的支持，我会继续努力！”</h6>
            <div>
                <div class="reward-code">
                    <img class="type-code" src="/css/images/wechat.jpg">
                    <img class="er-code" src="/css/images/wechat-pay.jpg">
                </div>
                <div class="reward-code">
                    <img class="type-code" src="/css/images/alipay.jpg">
                    <img class="er-code" src="/css/images/alipay-pay.jpg">
                </div>
            </div>
            <p class="reward-desc">扫码打赏，感谢支持</p>
        </div>
    </div>


          
          
    <div class="social-share">
      <span>分享到:</span>
    </div>



        </div>
      
      
        
<nav id="article-nav">
  
  
    <a href="/article/20210525.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">older</strong>
      <div class="article-nav-title">Python读取、新增、删除Set容器中的数据</div>
    </a>
  
</nav>

      
      
        
  <div id="comments"></div>








      
    </footer>
  </div>
</article>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-classify"></i> 分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/IDEA/">IDEA</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JVM/">JVM</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MyBatis/">MyBatis</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringMVC/">SpringMVC</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3/">博客相关</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/">安装与配置</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9E%B6%E6%9E%84/">架构</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a><span class="category-list-count">6</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> 归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年06月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年05月</a><span class="archive-list-count">15</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年04月</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年03月</a><span class="archive-list-count">13</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年02月</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020年07月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018年10月</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018年07月</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> 友情链接</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a href="https://blog.ecutdl.cn/" target="_blank" rel="noopener">左耳听风</a>
        </li>
      
        <li>
          <a href="https://chaooo.github.io/" target="_blank" rel="noopener">秋过冬漫长</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">网站地图</a>
        <span> | </span><a href="/atom.xml">订阅本站</a>
        <span> | </span><a href="/about/">联系博主</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2021 耿锐.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        
            <span>Count by <a href="http://busuanzi.ibruce.info/" target="_blank">busuanzi.</a></span>
        
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
    
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/search.json.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



  
<script src="/localshare/js/social-share.js"></script>

  
<script src="/localshare/js/qrcode.js"></script>





  
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

  
<script src="//cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>

  <script>
    var gitalk = new Gitalk({
      clientID: '2b288de9939594e51d70',
      clientSecret: '72c37a839721d882389905bbe5c73b51003585da',
      repo: 'BLOG-COMMENTS',
      owner: 'GengRui01',
      admin: ['GengRui01'],
      id: md5(window.location.pathname),
      distractionFreeMode: false,
      language: 'zh-CN',
      pagerDirection: 'last'
    });
    gitalk.render('comments');
  </script>
















  </div>
</body>
</html>